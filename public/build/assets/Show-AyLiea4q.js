import{d as Te,r as m,c as C,z as q,p as G,a as h,o as i,b as o,u as s,m as Ae,w as r,e as a,P as Pe,f as v,h as b,t as d,g as T,F as W,i as Me,bU as J}from"./app-WJ99k70a.js";import{V,f as Se}from"./AppLayout.vue_vue_type_script_setup_true_lang-Dy1GYN7i.js";import{c as te,_ as k}from"./Button.vue_vue_type_script_setup_true_lang-Dy3RlMKi.js";import{_ as Q}from"./Card.vue_vue_type_script_setup_true_lang-DflwHKhY.js";import{_ as Y}from"./CardContent.vue_vue_type_script_setup_true_lang-BMStSPTP.js";import{_ as $e}from"./CardDescription.vue_vue_type_script_setup_true_lang-DNHVeIuy.js";import{_ as Le}from"./CardHeader.vue_vue_type_script_setup_true_lang-DcM25_8J.js";import{_ as Z}from"./CardTitle.vue_vue_type_script_setup_true_lang-CE3nRRvq.js";import{_ as De}from"./index-DeNvFObS.js";import{_ as ee}from"./Slider.vue_vue_type_script_setup_true_lang-1KS7qu8P.js";import{_ as Ee}from"./Progress.vue_vue_type_script_setup_true_lang-Ca6Bt58w.js";import{_ as Re,a as Be}from"./index-BrSGzWf_.js";import{A as Ve}from"./arrow-left-o258duzw.js";import{R as S}from"./refresh-cw-CjotMkme.js";import{B as je}from"./book-open-ogWEErWF.js";import{C as ze}from"./clock-D6SfQS9I.js";import{R as Ie}from"./rotate-ccw-WdQZaTbN.js";import{C as ae}from"./circle-check-big-Bla7bMyD.js";import{T as Ne}from"./triangle-alert-CSdOLTA5.js";import{E as Fe}from"./external-link-CS8aNHze.js";import{S as Ue}from"./skip-back-Dh9R3J32.js";import{P as He}from"./play-DPPsbZ49.js";import{P as Ke}from"./pause-Cn4smIWa.js";import{S as Oe}from"./skip-forward-Avn8Vi1d.js";import{_ as Xe}from"./_plugin-vue_export-helper-fGKAwq7e.js";import"./index-CLwR-uw6.js";import"./index-Dhh5zSp0.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DJLofgmd.js";import"./useForwardPropsEmits-BNdFBwb6.js";import"./useSize-CepR3Y4N.js";import"./useForwardExpose-CBKzvtQE.js";import"./Collection-DgIeGgCh.js";import"./ConfigProvider-BzvyYtnr.js";import"./usePrimitiveElement-Bq8IOiVk.js";import"./VisuallyHidden-BcuC4gal.js";import"./VisuallyHiddenInput-Dx-JIC8p.js";import"./nullish-CHIgUVhi.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=te("HeadphonesIcon",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=te("VolumeXIcon",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),We={class:"max-w-4xl mx-auto space-y-6"},Je={class:"flex flex-col md:flex-row gap-6"},Qe={class:"w-full md:w-64 aspect-video bg-gradient-to-br from-blue-100 to-purple-100 rounded-lg overflow-hidden shrink-0 relative"},Ye=["src","alt"],Ze={key:1,class:"w-full h-full flex items-center justify-center"},ea={key:2,class:"absolute inset-0 bg-black/20 flex items-center justify-center"},aa={class:"bg-white/90 rounded-full p-3"},ta={class:"flex-1 space-y-4"},sa={key:0,class:"flex items-center gap-2 mb-2"},oa={class:"flex flex-wrap items-center gap-4"},la={class:"flex items-center gap-2 text-sm text-muted-foreground"},ra={class:"flex items-center gap-2 text-sm text-blue-600"},ua={class:"flex items-center gap-2 text-sm text-purple-600"},na={key:0,class:"flex items-center gap-2 text-sm text-green-600"},ia={class:"space-y-2"},da={class:"flex justify-between items-center text-sm"},ca={class:"font-medium"},ma={class:"flex justify-between text-xs text-muted-foreground"},fa={key:0,class:"ml-2 flex items-center gap-2 text-sm text-muted-foreground"},va=["src"],pa={class:"space-y-3"},ga={class:"flex gap-2"},_a=["href"],ha={key:1,class:"text-center py-8"},ya={class:"flex items-center justify-center gap-2 text-muted-foreground mb-4"},ka={key:2,class:"space-y-6"},ba={class:"flex items-center justify-center gap-4"},xa={class:"space-y-2"},wa={class:"flex justify-between text-sm text-muted-foreground"},Ca={class:"flex justify-between text-xs text-muted-foreground"},Ta={class:"flex flex-col sm:flex-row items-center justify-between gap-4"},Aa={class:"flex items-center gap-3"},Pa={class:"text-xs text-muted-foreground min-w-[3ch]"},Ma={class:"flex items-center gap-2"},Sa={class:"flex gap-1"},$a=Te({__name:"Show",props:{audio:{},user_progress:{}},setup(se){var O;const c=se,oe=(O=document.querySelector('meta[name="csrf-token"]'))==null?void 0:O.getAttribute("content"),le=[{title:"Dashboard",href:"/dashboard"},{title:"Audio Courses",href:"/audio"},{title:c.audio.name,href:"#"}],l=m(),x=m(!1),n=m(c.user_progress.current_time||0),g=m(c.audio.duration||0),y=m(1),A=m(!1),$=m(1),w=m(!0),p=m(""),f=m(!1),_=m(!1),re=C(()=>Math.floor(n.value)),j=m(!1),L=m(n.value),D=m(),P=m(),ue=[.5,.75,1,1.25,1.5,1.75,2],z=C(()=>g.value>0?n.value/g.value*100:0),ne=C(()=>I(n.value)),ie=C(()=>I(g.value)),de=C(()=>z.value>=95||n.value>=g.value-30),ce=C(()=>Math.min(z.value,100)),E=C(()=>{const e=re.value,t=Math.floor(e/60),u=e%60;return t>0?u>0?`${t}m ${u}s listened`:`${t}m listened`:u>0?`${u}s listened`:"0m listened"});function I(e){if(!e||isNaN(e))return"00:00";const t=Math.floor(e/60),u=Math.floor(e%60);return`${t.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`}function me(){j.value=!0}function N(){!l.value||!_.value||(x.value?l.value.pause():(f.value=!0,l.value.play().catch(e=>{console.error("Play failed:",e),p.value="Unable to play audio. The file might be restricted or your connection is slow.",f.value=!1})))}function R(e){!l.value||!_.value||(f.value=!0,l.value.currentTime=e,n.value=e,P.value&&clearTimeout(P.value),P.value=setTimeout(()=>{M()},1e3))}function F(){const e=Math.min(n.value+15,g.value);R(e)}function U(){const e=Math.max(n.value-15,0);R(e)}function H(){l.value&&(A.value=!A.value,l.value.muted=A.value)}function B(e){l.value&&(y.value=e[0],l.value.volume=y.value,y.value>0&&A.value&&(A.value=!1,l.value.muted=!1))}function fe(e){l.value&&($.value=e,l.value.playbackRate=e)}async function M(){console.log("saveProgress called!",{currentTime:n.value,lastSavedTime:L.value,audioId:c.audio.id});try{const e=Math.abs(n.value-L.value);if(e>=1){const t=await J.post(`/audio/${c.audio.id}/progress`,{current_time:n.value,total_listened_time:c.user_progress.total_listened_time+e});console.log("Progress API response:",t.data),t.data.success&&t.data.progress&&(c.user_progress.current_time=t.data.progress.current_time,c.user_progress.completion_percentage=t.data.progress.completion_percentage,c.user_progress.is_completed=t.data.progress.is_completed,console.log("✅ Local progress updated:",{completion:c.user_progress.completion_percentage,is_completed:c.user_progress.is_completed}),L.value=n.value)}}catch(e){console.error("Failed to save progress:",e.response||e)}}async function K(){console.log("markCompleted called for audio ID:",c.audio.id);try{const e=await J.post(`/audio/${c.audio.id}/complete`,{},{headers:{"X-CSRF-TOKEN":oe}});console.log("Complete API response:",e.data),e.data.success&&(console.log("Audio marked as completed successfully"),setTimeout(()=>{window.location.reload()},1e3))}catch(e){console.error("Failed to mark as completed:",e.response||e),e.value="Failed to mark as completed. Please try again."}}function ve(){l.value&&(p.value="",w.value=!0,_.value=!1,l.value.load())}function pe(){w.value=!0,f.value=!0,console.log("Audio loading started")}function ge(){_.value=!0,f.value=!1,console.log("Audio can start playing")}function _e(){l.value&&(g.value=l.value.duration||c.audio.duration,n.value>0&&n.value<g.value&&(l.value.currentTime=n.value),w.value=!1,f.value=!1,_.value=!0,p.value="",console.log("Audio loaded successfully, duration:",g.value,"resume from:",n.value))}function he(){l.value&&(n.value=l.value.currentTime,f.value=!1)}function ye(){x.value=!0,f.value=!1}function ke(){x.value=!1,M()}function be(){x.value=!1,n.value=g.value,c.user_progress.is_completed||K()}function xe(){f.value=!0,console.log("Audio is buffering...")}function we(){f.value=!1,x.value=!0}function Ce(e){var t;if(console.error("Audio loading error:",e),(t=l.value)!=null&&t.error){const u=l.value.error.code,X=l.value.error.message;switch(console.error("Audio error details:",{code:u,message:X}),u){case 1:p.value="Audio loading was aborted. Please try again.";break;case 2:p.value="Network error while loading audio. Check your connection and try again.";break;case 3:p.value="Audio file is corrupted or in an unsupported format.";break;case 4:p.value="Audio file format is not supported or file is not accessible.";break;default:p.value="Failed to load audio. The file might be private or moved."}}else p.value="Failed to load audio from Google Drive. Please check if the file is publicly accessible.";w.value=!1,f.value=!1,_.value=!1}return q(()=>{l.value&&(l.value.volume=y.value,l.value.playbackRate=$.value,l.value.preload="metadata"),D.value=setInterval(()=>{x.value&&M()},1e4);const e=()=>{M()};window.addEventListener("beforeunload",e),G(()=>{D.value&&clearInterval(D.value),P.value&&clearTimeout(P.value),window.removeEventListener("beforeunload",e),M()})}),q(()=>{function e(t){const u=t.target;if(!(u.tagName==="INPUT"||u.tagName==="TEXTAREA"||u.contentEditable==="true"))switch(t.code){case"Space":t.preventDefault(),N();break;case"ArrowLeft":t.preventDefault(),U();break;case"ArrowRight":t.preventDefault(),F();break;case"KeyM":t.preventDefault(),H();break;case"ArrowUp":t.preventDefault(),B([Math.min(y.value+.1,1)]);break;case"ArrowDown":t.preventDefault(),B([Math.max(y.value-.1,0)]);break}}document.addEventListener("keydown",e),G(()=>{document.removeEventListener("keydown",e)})}),(e,t)=>(i(),h(W,null,[o(s(Ae),{title:`${e.audio.name} - Audio Course`},null,8,["title"]),o(Se,{breadcrumbs:le},{default:r(()=>[a("div",We,[o(s(k),{asChild:"",variant:"ghost",class:"mb-4"},{default:r(()=>[o(s(Pe),{href:"/audio"},{default:r(()=>[o(s(Ve),{class:"h-4 w-4 mr-2"}),t[1]||(t[1]=v(" Back to Audio Courses "))]),_:1})]),_:1}),o(s(Q),null,{default:r(()=>[o(s(Y),{class:"p-6"},{default:r(()=>[a("div",Je,[a("div",Qe,[e.audio.thumbnail_url&&!j.value?(i(),h("img",{key:0,src:e.audio.thumbnail_url,alt:e.audio.name,class:"w-full h-full object-cover",onError:me},null,40,Ye)):(i(),h("div",Ze,[o(s(V),{class:"h-16 w-16 text-blue-500"})])),f.value||w.value?(i(),h("div",ea,[a("div",aa,[o(s(S),{class:"h-8 w-8 text-blue-600 animate-spin"})])])):b("",!0)]),a("div",ta,[a("div",null,[e.audio.category?(i(),h("div",sa,[o(s(je),{class:"h-4 w-4 text-muted-foreground"}),o(s(De),{variant:"outline"},{default:r(()=>[v(d(e.audio.category.name),1)]),_:1})])):b("",!0),o(s(Z),{class:"text-2xl mb-2"},{default:r(()=>[v(d(e.audio.name),1)]),_:1}),o(s($e),{class:"text-base"},{default:r(()=>[v(d(e.audio.description||"No description available"),1)]),_:1})]),a("div",oa,[a("div",la,[o(s(ze),{class:"h-4 w-4"}),a("span",null,d(e.audio.formatted_duration),1)]),a("div",ra,[o(s(Ie),{class:"h-4 w-4"}),a("span",null,d(Math.round(e.user_progress.completion_percentage))+"% Complete",1)]),a("div",ua,[o(s(qe),{class:"h-4 w-4"}),a("span",null,d(E.value),1)]),e.user_progress.is_completed?(i(),h("div",na,[o(s(ae),{class:"h-4 w-4"}),t[2]||(t[2]=a("span",null,"Completed",-1))])):b("",!0)]),a("div",ia,[a("div",da,[t[3]||(t[3]=a("span",{class:"text-muted-foreground"},"Overall Progress",-1)),a("span",ca,d(Math.round(e.user_progress.completion_percentage))+"%",1)]),o(s(Ee),{value:e.user_progress.completion_percentage,class:"h-2"},null,8,["value"]),a("div",ma,[a("span",null,d(e.user_progress.formatted_current_time)+" / "+d(e.audio.formatted_duration),1),a("span",null,d(E.value),1)])])])])]),_:1})]),_:1}),o(s(Q),null,{default:r(()=>[o(s(Le),null,{default:r(()=>[o(s(Z),{class:"flex items-center gap-2"},{default:r(()=>[o(s(V),{class:"h-5 w-5"}),t[5]||(t[5]=v(" Audio Player ")),f.value?(i(),h("div",fa,[o(s(S),{class:"h-4 w-4 animate-spin"}),t[4]||(t[4]=v(" Buffering... "))])):b("",!0)]),_:1})]),_:1}),o(s(Y),{class:"space-y-6"},{default:r(()=>[a("audio",{ref_key:"audioRef",ref:l,src:e.audio.google_cloud_url,preload:"metadata",onLoadstart:pe,onCanplay:ge,onLoadeddata:_e,onTimeupdate:he,onPlay:ye,onPause:ke,onEnded:be,onWaiting:xe,onPlaying:we,onError:Ce,crossorigin:"anonymous"},null,40,va),p.value?(i(),T(s(Re),{key:0,variant:"destructive"},{default:r(()=>[o(s(Ne),{class:"h-4 w-4"}),o(s(Be),null,{default:r(()=>[a("div",pa,[a("p",null,d(p.value),1),a("div",ga,[o(s(k),{onClick:ve,size:"sm",variant:"outline"},{default:r(()=>[o(s(S),{class:"h-4 w-4 mr-2"}),t[6]||(t[6]=v(" Retry "))]),_:1}),o(s(k),{asChild:"",size:"sm",variant:"outline"},{default:r(()=>[a("a",{href:e.audio.google_cloud_url,target:"_blank"},[o(s(Fe),{class:"h-4 w-4 mr-2"}),t[7]||(t[7]=v(" Open Direct Link "))],8,_a)]),_:1})])])]),_:1})]),_:1})):b("",!0),w.value&&!p.value?(i(),h("div",ha,[a("div",ya,[o(s(S),{class:"h-5 w-5 animate-spin"}),t[8]||(t[8]=a("span",null,"Loading audio from Google Drive...",-1))]),t[9]||(t[9]=a("div",{class:"text-sm text-muted-foreground"}," This may take a moment for large files ",-1))])):b("",!0),!w.value&&!p.value?(i(),h("div",ka,[a("div",ba,[o(s(k),{onClick:U,variant:"outline",size:"sm",disabled:!_.value},{default:r(()=>[o(s(Ue),{class:"h-4 w-4"})]),_:1},8,["disabled"]),o(s(k),{onClick:N,size:"lg",class:"h-14 w-14 rounded-full relative",disabled:!_.value},{default:r(()=>[f.value?(i(),T(s(S),{key:0,class:"h-6 w-6 animate-spin"})):x.value?(i(),T(s(Ke),{key:2,class:"h-6 w-6"})):(i(),T(s(He),{key:1,class:"h-6 w-6 ml-0.5"}))]),_:1},8,["disabled"]),o(s(k),{onClick:F,variant:"outline",size:"sm",disabled:!_.value},{default:r(()=>[o(s(Oe),{class:"h-4 w-4"})]),_:1},8,["disabled"])]),a("div",xa,[a("div",wa,[a("span",null,d(ne.value),1),a("span",null,d(ie.value),1)]),o(s(ee),{value:[n.value],max:g.value,step:1,"onUpdate:modelValue":t[0]||(t[0]=u=>R(u[0])),class:"w-full",disabled:!_.value},null,8,["value","max","disabled"]),a("div",Ca,[a("span",null,d(Math.round(ce.value))+"% played",1),a("span",null,d(E.value),1)])]),a("div",Ta,[a("div",Aa,[o(s(k),{onClick:H,variant:"ghost",size:"sm"},{default:r(()=>[!A.value&&y.value>0?(i(),T(s(V),{key:0,class:"h-4 w-4"})):(i(),T(s(Ge),{key:1,class:"h-4 w-4"}))]),_:1}),o(s(ee),{value:[y.value],max:1,step:.1,"onUpdate:modelValue":B,class:"w-24"},null,8,["value"]),a("span",Pa,d(Math.round(y.value*100))+"% ",1)]),a("div",Ma,[t[10]||(t[10]=a("span",{class:"text-sm text-muted-foreground"},"Speed:",-1)),a("div",Sa,[(i(),h(W,null,Me(ue,u=>o(s(k),{key:u,onClick:X=>fe(u),variant:$.value===u?"default":"outline",size:"sm",class:"text-xs px-2 py-1 h-auto"},{default:r(()=>[v(d(u)+"x ",1)]),_:2},1032,["onClick","variant"])),64))])]),de.value&&!e.user_progress.is_completed?(i(),T(s(k),{key:0,onClick:K,variant:"outline",size:"sm",class:"gap-2"},{default:r(()=>[o(s(ae),{class:"h-4 w-4"}),t[11]||(t[11]=v(" Mark Complete "))]),_:1})):b("",!0)]),t[12]||(t[12]=a("div",{class:"text-xs text-muted-foreground text-center space-y-1"},[a("div",{class:"font-medium"},"Keyboard Shortcuts:"),a("div",{class:"flex flex-wrap justify-center gap-x-4 gap-y-1"},[a("span",null,[a("kbd",{class:"px-1 bg-muted rounded"},"Space"),v(" Play/Pause")]),a("span",null,[a("kbd",{class:"px-1 bg-muted rounded"},"←/→"),v(" Skip 15s")]),a("span",null,[a("kbd",{class:"px-1 bg-muted rounded"},"M"),v(" Mute")]),a("span",null,[a("kbd",{class:"px-1 bg-muted rounded"},"↑/↓"),v(" Volume")])])],-1))])):b("",!0)]),_:1})]),_:1})])]),_:1})],64))}}),vt=Xe($a,[["__scopeId","data-v-1adc3146"]]);export{vt as default};
