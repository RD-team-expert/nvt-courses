import{d as Ve,r as m,c as x,A as H,p as J,a as p,o as f,b as s,u as t,m as Pe,w as l,e as o,g as M,h as k,P as Be,f as d,t as i,F as Q,i as Ee,j as Z,bU as F}from"./app-BMyidKIh.js";import{f as Me}from"./AppLayout.vue_vue_type_script_setup_true_lang-CeyhSayX.js";import{c as Fe,_ as h}from"./Button.vue_vue_type_script_setup_true_lang-Fk6a1Vva.js";import{_ as U}from"./Card.vue_vue_type_script_setup_true_lang-CQovGjFq.js";import{_ as z}from"./CardContent.vue_vue_type_script_setup_true_lang-Dyzxu5FP.js";import{_ as Le}from"./CardDescription.vue_vue_type_script_setup_true_lang-CvcJ_Am_.js";import{_ as ee}from"./CardHeader.vue_vue_type_script_setup_true_lang-_dtBwzkO.js";import{_ as K}from"./CardTitle.vue_vue_type_script_setup_true_lang-zaBMsOvU.js";import{_ as O}from"./index-C3o0bvIk.js";import{_ as Ae}from"./Slider.vue_vue_type_script_setup_true_lang-JFVXPKPj.js";import{_ as De}from"./Progress.vue_vue_type_script_setup_true_lang-Bm2abfAJ.js";import{_ as Ne,a as je}from"./index-yEoCS5nH.js";import{_ as Re}from"./Textarea.vue_vue_type_script_setup_true_lang-7L_wYbMO.js";import{_ as Ie}from"./Label.vue_vue_type_script_setup_true_lang-Coq7pT1m.js";import{_ as Ue,a as ze,b as Ke,c as Oe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CjCc3yLW.js";import{_ as qe}from"./DialogDescription.vue_vue_type_script_setup_true_lang-BOCx0qGm.js";import{_ as Xe}from"./DialogFooter.vue_vue_type_script_setup_true_lang-BGgMuzFt.js";import{A as We}from"./arrow-left-WoxIE4Hy.js";import{S as ae}from"./square-play-D3nHx9E6.js";import{R as L}from"./refresh-cw-eJX7_DY3.js";import{F as Ge}from"./folder-open-DjWkNtHJ.js";import{C as Ye}from"./clock-C9ZtgHl0.js";import{R as He}from"./rotate-ccw-vI8G8xvO.js";import{E as Je}from"./eye-r3W5mp7L.js";import{C as q}from"./circle-check-big-Cmw2hoxS.js";import{T as Qe}from"./triangle-alert-BGzxpn4P.js";import{E as Ze}from"./external-link-B77_dNZy.js";import{S as ea}from"./square-pen-DgRNf_fG.js";import{T as aa}from"./trash-2-DdRoljCP.js";import{_ as ta}from"./_plugin-vue_export-helper-Cg8ARLjz.js";import"./index-B9hR5wOz.js";import"./index-C3Bn3h4x.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CPGGLHXe.js";import"./useForwardPropsEmits-DPcO4mtR.js";import"./useSize-DbKzACL9.js";import"./useForwardExpose-DMAVYlpA.js";import"./Collection-CjETHI6E.js";import"./ConfigProvider-BNe-qVox.js";import"./usePrimitiveElement-s00YWk2f.js";import"./VisuallyHidden-hOZS4qMA.js";import"./VisuallyHiddenInput-BJXawX5X.js";import"./nullish-CHIgUVhi.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=Fe("BookmarkIcon",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]),oa={class:"max-w-4xl mx-auto space-y-6"},sa={class:"flex flex-col md:flex-row gap-6"},la={class:"w-full md:w-64 aspect-video bg-gradient-to-br from-blue-100 to-purple-100 rounded-lg overflow-hidden shrink-0 relative"},ra=["src","alt"],na={key:1,class:"w-full h-full flex items-center justify-center"},ia={key:2,class:"absolute inset-0 bg-black/20 flex items-center justify-center"},ua={class:"bg-white/90 rounded-full p-3"},da={class:"flex-1 space-y-4"},ca={key:0,class:"flex items-center gap-2 mb-2"},ma={class:"flex flex-wrap items-center gap-4"},fa={class:"flex items-center gap-2 text-sm text-muted-foreground"},va={class:"flex items-center gap-2 text-sm text-blue-600"},pa={class:"flex items-center gap-2 text-sm text-purple-600"},_a={key:0,class:"flex items-center gap-2 text-sm text-green-600"},ga={class:"space-y-2"},ka={class:"flex justify-between items-center text-sm"},ha={class:"font-medium"},ba={class:"flex justify-between text-xs text-muted-foreground"},ya={key:0,class:"ml-2 flex items-center gap-2 text-sm text-muted-foreground"},wa={class:"relative aspect-video bg-black rounded-lg overflow-hidden"},xa=["src","poster"],Ca={key:0,class:"absolute inset-0 bg-black/80 flex items-center justify-center"},$a={class:"text-center text-white"},Ta={class:"space-y-3"},Sa={class:"flex gap-2"},Va=["href"],Pa={key:1,class:"space-y-4"},Ba={class:"space-y-2"},Ea={class:"flex justify-between text-sm text-muted-foreground"},Ma={class:"flex justify-between text-xs text-muted-foreground"},Fa={class:"flex items-center justify-between"},La={class:"flex items-center gap-4 text-sm text-muted-foreground"},Aa={class:"flex items-center gap-2"},Da={class:"grid gap-3"},Na=["onClick"],ja={class:"flex-1 min-w-0"},Ra={class:"font-medium text-sm"},Ia={key:0,class:"text-xs text-muted-foreground mt-1"},Ua={class:"flex items-center gap-1 ml-2"},za={class:"space-y-4"},Ka=Ve({__name:"Show",props:{video:{},user_progress:{},bookmarks:{}},setup(oe){var Y;const c=oe,A=(Y=document.querySelector('meta[name="csrf-token"]'))==null?void 0:Y.getAttribute("content"),se=[{title:"Dashboard",href:"/dashboard"},{title:"Video Courses",href:"/videos"},{title:c.video.name,href:"#"}],n=m(),C=m(!1),u=m(c.user_progress.current_time||0),g=m(c.video.duration||0),b=m(!0),v=m(""),_=m(!1),y=m(!1),X=m(!1),$=m(!1),T=m(""),B=m(!1),S=m(!1),E=m(!1),le=x(()=>Math.floor(u.value)),D=m(u.value),N=m(),V=m(),W=x(()=>g.value>0?u.value/g.value*100:0),re=x(()=>R(u.value)),ne=x(()=>R(g.value)),ie=x(()=>W.value>=95||u.value>=g.value-30),ue=x(()=>Math.min(W.value,100)),j=x(()=>{const e=le.value,a=Math.floor(e/60),r=e%60;return a>0?r>0?`${a}m ${r}s watched`:`${a}m watched`:r>0?`${r}s watched`:"0m watched"});function R(e){if(!e||isNaN(e))return"00:00";const a=Math.floor(e/3600),r=Math.floor(e%3600/60),w=Math.floor(e%60);return a>0?`${a.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`:`${r.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`}function de(){X.value=!0}function I(e){!n.value||!y.value||(_.value=!0,n.value.currentTime=e,u.value=e,V.value&&clearTimeout(V.value),V.value=setTimeout(()=>{P()},1e3))}async function P(){console.log("saveProgress called!",{currentTime:u.value,lastSavedTime:D.value,videoId:c.video.id});try{const e=Math.abs(u.value-D.value);if(e>=1){const a=await F.post(`/videos/${c.video.id}/progress`,{current_time:u.value,total_watched_time:c.user_progress.total_watched_time+e});console.log("Progress API response:",a.data),a.data.success&&a.data.progress&&(c.user_progress.current_time=a.data.progress.current_time,c.user_progress.completion_percentage=a.data.progress.completion_percentage,c.user_progress.is_completed=a.data.progress.is_completed,console.log("✅ Local progress updated:",{completion:c.user_progress.completion_percentage,is_completed:c.user_progress.is_completed}),D.value=u.value)}}catch(e){console.error("Failed to save progress:",e.response||e)}}async function G(){console.log("markCompleted called for video ID:",c.video.id);try{E.value=!0;const e=await F.post(`/videos/${c.video.id}/complete`,{},{headers:{"X-CSRF-TOKEN":A}});console.log("Complete API response:",e.data),e.data.success&&(console.log("Video marked as completed successfully"),setTimeout(()=>{window.location.reload()},1e3))}catch(e){console.error("Failed to mark as completed:",e.response||e),e.value="Failed to mark as completed. Please try again."}finally{E.value=!1}}function ce(){$.value=!0,T.value="",B.value=!0}async function me(){if(!S.value){S.value=!0;try{const e=await F.post(`/videos/${c.video.id}/bookmarks`,{timestamp:u.value,note:T.value.trim()||null},{headers:{"X-CSRF-TOKEN":A}});e.data.success&&(c.bookmarks.push(e.data.bookmark),$.value=!1,T.value="")}catch(e){console.error("Failed to save bookmark:",e)}finally{S.value=!1,B.value=!1}}}function fe(e){n.value&&(n.value.currentTime=e,u.value=e)}function ve(e){console.log("Edit bookmark:",e)}async function pe(e){if(confirm("Are you sure you want to delete this bookmark?"))try{if((await F.delete(`/video-bookmarks/${e.id}`,{headers:{"X-CSRF-TOKEN":A}})).data.success){const r=c.bookmarks.findIndex(w=>w.id===e.id);r>-1&&c.bookmarks.splice(r,1)}}catch(a){console.error("Failed to delete bookmark:",a)}}function _e(){n.value&&(v.value="",b.value=!0,y.value=!1,n.value.load())}function ge(){b.value=!0,_.value=!0,console.log("Video loading started")}function ke(){y.value=!0,_.value=!1,console.log("Video can start playing")}function he(){n.value&&(g.value=n.value.duration||c.video.duration,u.value>0&&u.value<g.value&&(n.value.currentTime=u.value),b.value=!1,_.value=!1,y.value=!0,v.value="",console.log("Video loaded successfully, duration:",g.value,"resume from:",u.value))}function be(){n.value&&(u.value=n.value.currentTime,_.value=!1)}function ye(){C.value=!0,_.value=!1}function we(){C.value=!1,P()}function xe(){C.value=!1,u.value=g.value,c.user_progress.is_completed||G()}function Ce(){_.value=!0,console.log("Video is buffering...")}function $e(){_.value=!1,C.value=!0}function Te(e){var a;if(console.error("Video loading error:",e),(a=n.value)!=null&&a.error){const r=n.value.error.code;switch(console.error("Video error code:",r),r){case 1:v.value="Video loading was aborted. Please try again.";break;case 2:v.value="Network error while loading video. Check your connection and try again.";break;case 3:v.value="Video file is corrupted or in an unsupported format.";break;case 4:v.value="Video file format is not supported or file is not accessible.";break;default:v.value="Failed to load video. The file might be private or moved."}}else v.value="Failed to load video from Google Drive. Please check if the file is publicly accessible.";b.value=!1,_.value=!1,y.value=!1}function Se(){console.log("Playback rate changed")}return H(()=>{n.value&&(n.value.preload="metadata"),N.value=setInterval(()=>{C.value&&P()},1e4);const e=()=>{P()};window.addEventListener("beforeunload",e),J(()=>{N.value&&clearInterval(N.value),V.value&&clearTimeout(V.value),window.removeEventListener("beforeunload",e),P()})}),H(()=>{function e(a){const r=a.target;if(!(r.tagName==="INPUT"||r.tagName==="TEXTAREA"||r.contentEditable==="true"))switch(a.code){case"Space":a.preventDefault(),n.value&&(n.value.paused?n.value.play():n.value.pause());break;case"ArrowLeft":a.preventDefault(),I(Math.max(u.value-10,0));break;case"ArrowRight":a.preventDefault(),I(Math.min(u.value+10,g.value));break;case"KeyM":a.preventDefault(),n.value&&(n.value.muted=!n.value.muted);break;case"KeyF":a.preventDefault(),n.value&&(document.fullscreenElement?document.exitFullscreen():n.value.requestFullscreen());break}}document.addEventListener("keydown",e),J(()=>{document.removeEventListener("keydown",e)})}),(e,a)=>(f(),p(Q,null,[s(t(Pe),{title:`${e.video.name} - Video Course`},null,8,["title"]),s(Me,{breadcrumbs:se},{default:l(()=>[o("div",oa,[s(t(h),{asChild:"",variant:"ghost",class:"mb-4"},{default:l(()=>[s(t(Be),{href:"/videos"},{default:l(()=>[s(t(We),{class:"h-4 w-4 mr-2"}),a[4]||(a[4]=d(" Back to Video Courses "))]),_:1})]),_:1}),s(t(U),null,{default:l(()=>[s(t(z),{class:"p-6"},{default:l(()=>[o("div",sa,[o("div",la,[e.video.thumbnail_url&&!X.value?(f(),p("img",{key:0,src:e.video.thumbnail_url,alt:e.video.name,class:"w-full h-full object-cover",onError:de},null,40,ra)):(f(),p("div",na,[s(t(ae),{class:"h-16 w-16 text-blue-500"})])),_.value||b.value?(f(),p("div",ia,[o("div",ua,[s(t(L),{class:"h-8 w-8 text-blue-600 animate-spin"})])])):k("",!0)]),o("div",da,[o("div",null,[e.video.category?(f(),p("div",ca,[s(t(Ge),{class:"h-4 w-4 text-muted-foreground"}),s(t(O),{variant:"outline"},{default:l(()=>[d(i(e.video.category.name),1)]),_:1})])):k("",!0),s(t(K),{class:"text-2xl mb-2"},{default:l(()=>[d(i(e.video.name),1)]),_:1}),s(t(Le),{class:"text-base"},{default:l(()=>[d(i(e.video.description||"No description available"),1)]),_:1})]),o("div",ma,[o("div",fa,[s(t(Ye),{class:"h-4 w-4"}),o("span",null,i(e.video.formatted_duration),1)]),o("div",va,[s(t(He),{class:"h-4 w-4"}),o("span",null,i(Math.round(e.user_progress.completion_percentage))+"% Complete",1)]),o("div",pa,[s(t(Je),{class:"h-4 w-4"}),o("span",null,i(j.value),1)]),e.user_progress.is_completed?(f(),p("div",_a,[s(t(q),{class:"h-4 w-4"}),a[5]||(a[5]=o("span",null,"Completed",-1))])):k("",!0)]),o("div",ga,[o("div",ka,[a[6]||(a[6]=o("span",{class:"text-muted-foreground"},"Overall Progress",-1)),o("span",ha,i(Math.round(e.user_progress.completion_percentage))+"%",1)]),s(t(De),{value:e.user_progress.completion_percentage,class:"h-2"},null,8,["value"]),o("div",ba,[o("span",null,i(e.user_progress.formatted_current_time)+" / "+i(e.video.formatted_duration),1),o("span",null,i(j.value),1)])])])])]),_:1})]),_:1}),s(t(U),null,{default:l(()=>[s(t(ee),null,{default:l(()=>[s(t(K),{class:"flex items-center gap-2"},{default:l(()=>[s(t(ae),{class:"h-5 w-5"}),a[8]||(a[8]=d(" Video Player ")),_.value?(f(),p("div",ya,[s(t(L),{class:"h-4 w-4 animate-spin"}),a[7]||(a[7]=d(" Buffering... "))])):k("",!0)]),_:1})]),_:1}),s(t(z),{class:"space-y-6"},{default:l(()=>[o("div",wa,[o("video",{ref_key:"videoRef",ref:n,class:"w-full h-full",src:e.video.google_drive_url,poster:e.video.thumbnail_url,controls:"",preload:"metadata",onLoadstart:ge,onCanplay:ke,onLoadeddata:he,onTimeupdate:be,onPlay:ye,onPause:we,onEnded:xe,onWaiting:Ce,onPlaying:$e,onError:Te,onRatechange:Se,crossorigin:"anonymous"}," Your browser does not support the video tag. ",40,xa),b.value&&!v.value?(f(),p("div",Ca,[o("div",$a,[s(t(L),{class:"h-12 w-12 animate-spin mx-auto mb-4"}),a[9]||(a[9]=o("p",null,"Loading video from Google Drive...",-1)),a[10]||(a[10]=o("div",{class:"text-sm text-gray-300 mt-2"},"This may take a moment for large files",-1))])])):k("",!0)]),v.value?(f(),M(t(Ne),{key:0,variant:"destructive"},{default:l(()=>[s(t(Qe),{class:"h-4 w-4"}),s(t(je),null,{default:l(()=>[o("div",Ta,[o("p",null,i(v.value),1),o("div",Sa,[s(t(h),{onClick:_e,size:"sm",variant:"outline"},{default:l(()=>[s(t(L),{class:"h-4 w-4 mr-2"}),a[11]||(a[11]=d(" Retry "))]),_:1}),s(t(h),{asChild:"",size:"sm",variant:"outline"},{default:l(()=>[o("a",{href:e.video.google_drive_url,target:"_blank"},[s(t(Ze),{class:"h-4 w-4 mr-2"}),a[12]||(a[12]=d(" Open Direct Link "))],8,Va)]),_:1})])])]),_:1})]),_:1})):k("",!0),!b.value&&!v.value?(f(),p("div",Pa,[o("div",Ba,[o("div",Ea,[o("span",null,i(re.value),1),o("span",null,i(ne.value),1)]),s(t(Ae),{value:[u.value],max:g.value,step:.1,"onUpdate:modelValue":a[0]||(a[0]=r=>I(r[0])),class:"w-full",disabled:!y.value},null,8,["value","max","disabled"]),o("div",Ma,[o("span",null,i(Math.round(ue.value))+"% watched",1),o("span",null,i(j.value),1)])]),o("div",Fa,[o("div",La,[s(t(O),{variant:e.user_progress.is_completed?"default":"secondary"},{default:l(()=>[d(i(Math.round(e.user_progress.completion_percentage))+"% Complete ",1)]),_:1},8,["variant"])]),o("div",Aa,[s(t(h),{size:"sm",variant:"outline",onClick:ce,disabled:B.value||!y.value},{default:l(()=>[s(t(te),{class:"h-4 w-4 mr-2"}),d(" "+i(B.value?"Adding...":"Bookmark"),1)]),_:1},8,["disabled"]),ie.value&&!e.user_progress.is_completed?(f(),M(t(h),{key:0,size:"sm",onClick:G,disabled:E.value},{default:l(()=>[s(t(q),{class:"h-4 w-4 mr-2"}),d(" "+i(E.value?"Marking...":"Mark Complete"),1)]),_:1},8,["disabled"])):e.user_progress.is_completed?(f(),M(t(O),{key:1,variant:"default",class:"px-3 py-1"},{default:l(()=>[s(t(q),{class:"h-4 w-4 mr-1"}),a[13]||(a[13]=d(" Completed "))]),_:1})):k("",!0)])]),a[14]||(a[14]=o("div",{class:"text-xs text-muted-foreground text-center space-y-1"},[o("div",{class:"font-medium"},"Video Controls:"),o("div",{class:"flex flex-wrap justify-center gap-x-4 gap-y-1"},[o("span",null,[o("kbd",{class:"px-1 bg-muted rounded"},"Space"),d(" Play/Pause")]),o("span",null,[o("kbd",{class:"px-1 bg-muted rounded"},"←/→"),d(" Skip 10s")]),o("span",null,[o("kbd",{class:"px-1 bg-muted rounded"},"M"),d(" Mute")]),o("span",null,[o("kbd",{class:"px-1 bg-muted rounded"},"F"),d(" Fullscreen")])])],-1))])):k("",!0)]),_:1})]),_:1}),e.bookmarks.length>0?(f(),M(t(U),{key:0},{default:l(()=>[s(t(ee),null,{default:l(()=>[s(t(K),{class:"flex items-center gap-2"},{default:l(()=>[s(t(te),{class:"h-5 w-5"}),d(" Your Bookmarks ("+i(e.bookmarks.length)+") ",1)]),_:1})]),_:1}),s(t(z),null,{default:l(()=>[o("div",Da,[(f(!0),p(Q,null,Ee(e.bookmarks,r=>(f(),p("div",{key:r.id,class:"flex items-start justify-between p-3 bg-muted/50 rounded-lg hover:bg-muted transition-colors cursor-pointer",onClick:w=>fe(r.timestamp)},[o("div",ja,[o("div",Ra,i(r.formatted_timestamp),1),r.note?(f(),p("div",Ia,i(r.note),1)):k("",!0)]),o("div",Ua,[s(t(h),{size:"sm",variant:"ghost",onClick:Z(w=>ve(r),["stop"])},{default:l(()=>[s(t(ea),{class:"h-3 w-3"})]),_:2},1032,["onClick"]),s(t(h),{size:"sm",variant:"ghost",onClick:Z(w=>pe(r),["stop"])},{default:l(()=>[s(t(aa),{class:"h-3 w-3"})]),_:2},1032,["onClick"])])],8,Na))),128))])]),_:1})]),_:1})):k("",!0),s(t(Ue),{open:$.value,"onUpdate:open":a[3]||(a[3]=r=>$.value=r)},{default:l(()=>[s(t(ze),{class:"sm:max-w-md"},{default:l(()=>[s(t(Ke),null,{default:l(()=>[s(t(Oe),null,{default:l(()=>a[15]||(a[15]=[d("Add Bookmark")])),_:1}),s(t(qe),null,{default:l(()=>[d(" Add a bookmark at "+i(R(u.value)),1)]),_:1})]),_:1}),o("div",za,[o("div",null,[s(t(Ie),{for:"bookmark-note"},{default:l(()=>a[16]||(a[16]=[d("Note (optional)")])),_:1}),s(t(Re),{id:"bookmark-note",modelValue:T.value,"onUpdate:modelValue":a[1]||(a[1]=r=>T.value=r),placeholder:"Add a note for this bookmark...",rows:"3"},null,8,["modelValue"])])]),s(t(Xe),null,{default:l(()=>[s(t(h),{variant:"outline",onClick:a[2]||(a[2]=r=>$.value=!1)},{default:l(()=>a[17]||(a[17]=[d(" Cancel ")])),_:1}),s(t(h),{onClick:me,disabled:S.value},{default:l(()=>[d(i(S.value?"Saving...":"Save Bookmark"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])])]),_:1})],64))}}),Mt=ta(Ka,[["__scopeId","data-v-be6dd070"]]);export{Mt as default};
