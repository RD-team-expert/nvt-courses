import{d as Ce,r as m,c as C,A as G,p as q,a as h,o as i,b as o,u as t,m as Te,w as r,e as a,P as Pe,f as v,h as k,t as d,g as T,F as W,i as Ae,bU as J}from"./app-a03Td8AO.js";import{V,f as Me}from"./AppLayout.vue_vue_type_script_setup_true_lang-BtRV7dmQ.js";import{c as Se,_ as b}from"./Button.vue_vue_type_script_setup_true_lang-B5Jc8OB_.js";import{_ as Q}from"./Card.vue_vue_type_script_setup_true_lang-CcwtovlE.js";import{_ as Y}from"./CardContent.vue_vue_type_script_setup_true_lang-48thBhlf.js";import{_ as $e}from"./CardDescription.vue_vue_type_script_setup_true_lang-Bzd5VNNh.js";import{_ as Le}from"./CardHeader.vue_vue_type_script_setup_true_lang-CkiucLnK.js";import{_ as Z}from"./CardTitle.vue_vue_type_script_setup_true_lang-CS-xFa-8.js";import{_ as De}from"./index-CgcmHAQd.js";import{_ as ee}from"./Slider.vue_vue_type_script_setup_true_lang-f1m5FFsv.js";import{_ as Ee}from"./Progress.vue_vue_type_script_setup_true_lang-BlfNdZNZ.js";import{_ as Re,a as Be}from"./index-wU2Gu9-g.js";import{A as Ve}from"./arrow-left-_a93OlsO.js";import{R as S}from"./refresh-cw-D82eb3g0.js";import{B as Ne}from"./book-open-Cbfo2PJC.js";import{C as je}from"./clock-Q2Hh7aYA.js";import{R as Ie}from"./rotate-ccw-D4vWGP7b.js";import{C as ae}from"./circle-check-big-BftkimyP.js";import{T as Fe}from"./triangle-alert-NUk9sScP.js";import{E as ze}from"./external-link-LduVkVYy.js";import{S as Ue,V as Ke}from"./volume-x-CHMdFe2_.js";import{P as Oe}from"./play-Cl_vt8jq.js";import{P as He}from"./pause-BCB34goG.js";import{S as Xe}from"./skip-forward-BwSY-M3T.js";import{_ as Ge}from"./_plugin-vue_export-helper-BpWa5mkE.js";import"./index-BgQo1FYJ.js";import"./index-DN9I7hhh.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CaeMCOIi.js";import"./useForwardPropsEmits-B05q2cpM.js";import"./useSize-CrFqmKpC.js";import"./useForwardExpose-p4rPV_-R.js";import"./Collection-Cu0tVr88.js";import"./ConfigProvider-Bs6s6bNv.js";import"./usePrimitiveElement-CQo2ru1d.js";import"./VisuallyHidden-BWNIAjkk.js";import"./VisuallyHiddenInput-BUJtVPgU.js";import"./nullish-CHIgUVhi.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=Se("HeadphonesIcon",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]),We={class:"max-w-4xl mx-auto space-y-6"},Je={class:"flex flex-col md:flex-row gap-6"},Qe={class:"w-full md:w-64 aspect-video bg-gradient-to-br from-blue-100 to-purple-100 rounded-lg overflow-hidden shrink-0 relative"},Ye=["src","alt"],Ze={key:1,class:"w-full h-full flex items-center justify-center"},ea={key:2,class:"absolute inset-0 bg-black/20 flex items-center justify-center"},aa={class:"bg-white/90 rounded-full p-3"},sa={class:"flex-1 space-y-4"},ta={key:0,class:"flex items-center gap-2 mb-2"},oa={class:"flex flex-wrap items-center gap-4"},la={class:"flex items-center gap-2 text-sm text-muted-foreground"},ra={class:"flex items-center gap-2 text-sm text-blue-600"},ua={class:"flex items-center gap-2 text-sm text-purple-600"},na={key:0,class:"flex items-center gap-2 text-sm text-green-600"},ia={class:"space-y-2"},da={class:"flex justify-between items-center text-sm"},ca={class:"font-medium"},ma={class:"flex justify-between text-xs text-muted-foreground"},fa={key:0,class:"ml-2 flex items-center gap-2 text-sm text-muted-foreground"},va=["src"],pa={class:"space-y-3"},ga={class:"flex gap-2"},_a=["href"],ha={key:1,class:"text-center py-8"},ya={class:"flex items-center justify-center gap-2 text-muted-foreground mb-4"},ba={key:2,class:"space-y-6"},ka={class:"flex items-center justify-center gap-4"},xa={class:"space-y-2"},wa={class:"flex justify-between text-sm text-muted-foreground"},Ca={class:"flex justify-between text-xs text-muted-foreground"},Ta={class:"flex flex-col sm:flex-row items-center justify-between gap-4"},Pa={class:"flex items-center gap-3"},Aa={class:"text-xs text-muted-foreground min-w-[3ch]"},Ma={class:"flex items-center gap-2"},Sa={class:"flex gap-1"},$a=Ce({__name:"Show",props:{audio:{},user_progress:{}},setup(se){var H;const c=se,te=(H=document.querySelector('meta[name="csrf-token"]'))==null?void 0:H.getAttribute("content"),oe=[{title:"Dashboard",href:"/dashboard"},{title:"Audio Courses",href:"/audio"},{title:c.audio.name,href:"#"}],l=m(),x=m(!1),n=m(c.user_progress.current_time||0),g=m(c.audio.duration||0),y=m(1),P=m(!1),$=m(1),w=m(!0),p=m(""),f=m(!1),_=m(!1),le=C(()=>Math.floor(n.value)),N=m(!1),L=m(n.value),D=m(),A=m(),re=[.5,.75,1,1.25,1.5,1.75,2],j=C(()=>g.value>0?n.value/g.value*100:0),ue=C(()=>I(n.value)),ne=C(()=>I(g.value)),ie=C(()=>j.value>=95||n.value>=g.value-30),de=C(()=>Math.min(j.value,100)),E=C(()=>{const e=le.value,s=Math.floor(e/60),u=e%60;return s>0?u>0?`${s}m ${u}s listened`:`${s}m listened`:u>0?`${u}s listened`:"0m listened"});function I(e){if(!e||isNaN(e))return"00:00";const s=Math.floor(e/60),u=Math.floor(e%60);return`${s.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`}function ce(){N.value=!0}function F(){!l.value||!_.value||(x.value?l.value.pause():(f.value=!0,l.value.play().catch(e=>{console.error("Play failed:",e),p.value="Unable to play audio. The file might be restricted or your connection is slow.",f.value=!1})))}function R(e){!l.value||!_.value||(f.value=!0,l.value.currentTime=e,n.value=e,A.value&&clearTimeout(A.value),A.value=setTimeout(()=>{M()},1e3))}function z(){const e=Math.min(n.value+15,g.value);R(e)}function U(){const e=Math.max(n.value-15,0);R(e)}function K(){l.value&&(P.value=!P.value,l.value.muted=P.value)}function B(e){l.value&&(y.value=e[0],l.value.volume=y.value,y.value>0&&P.value&&(P.value=!1,l.value.muted=!1))}function me(e){l.value&&($.value=e,l.value.playbackRate=e)}async function M(){console.log("saveProgress called!",{currentTime:n.value,lastSavedTime:L.value,audioId:c.audio.id});try{const e=Math.abs(n.value-L.value);if(e>=1){const s=await J.post(`/audio/${c.audio.id}/progress`,{current_time:n.value,total_listened_time:c.user_progress.total_listened_time+e});console.log("Progress API response:",s.data),s.data.success&&s.data.progress&&(c.user_progress.current_time=s.data.progress.current_time,c.user_progress.completion_percentage=s.data.progress.completion_percentage,c.user_progress.is_completed=s.data.progress.is_completed,console.log("✅ Local progress updated:",{completion:c.user_progress.completion_percentage,is_completed:c.user_progress.is_completed}),L.value=n.value)}}catch(e){console.error("Failed to save progress:",e.response||e)}}async function O(){console.log("markCompleted called for audio ID:",c.audio.id);try{const e=await J.post(`/audio/${c.audio.id}/complete`,{},{headers:{"X-CSRF-TOKEN":te}});console.log("Complete API response:",e.data),e.data.success&&(console.log("Audio marked as completed successfully"),setTimeout(()=>{window.location.reload()},1e3))}catch(e){console.error("Failed to mark as completed:",e.response||e),e.value="Failed to mark as completed. Please try again."}}function fe(){l.value&&(p.value="",w.value=!0,_.value=!1,l.value.load())}function ve(){w.value=!0,f.value=!0,console.log("Audio loading started")}function pe(){_.value=!0,f.value=!1,console.log("Audio can start playing")}function ge(){l.value&&(g.value=l.value.duration||c.audio.duration,n.value>0&&n.value<g.value&&(l.value.currentTime=n.value),w.value=!1,f.value=!1,_.value=!0,p.value="",console.log("Audio loaded successfully, duration:",g.value,"resume from:",n.value))}function _e(){l.value&&(n.value=l.value.currentTime,f.value=!1)}function he(){x.value=!0,f.value=!1}function ye(){x.value=!1,M()}function be(){x.value=!1,n.value=g.value,c.user_progress.is_completed||O()}function ke(){f.value=!0,console.log("Audio is buffering...")}function xe(){f.value=!1,x.value=!0}function we(e){var s;if(console.error("Audio loading error:",e),(s=l.value)!=null&&s.error){const u=l.value.error.code,X=l.value.error.message;switch(console.error("Audio error details:",{code:u,message:X}),u){case 1:p.value="Audio loading was aborted. Please try again.";break;case 2:p.value="Network error while loading audio. Check your connection and try again.";break;case 3:p.value="Audio file is corrupted or in an unsupported format.";break;case 4:p.value="Audio file format is not supported or file is not accessible.";break;default:p.value="Failed to load audio. The file might be private or moved."}}else p.value="Failed to load audio from Google Drive. Please check if the file is publicly accessible.";w.value=!1,f.value=!1,_.value=!1}return G(()=>{l.value&&(l.value.volume=y.value,l.value.playbackRate=$.value,l.value.preload="metadata"),D.value=setInterval(()=>{x.value&&M()},1e4);const e=()=>{M()};window.addEventListener("beforeunload",e),q(()=>{D.value&&clearInterval(D.value),A.value&&clearTimeout(A.value),window.removeEventListener("beforeunload",e),M()})}),G(()=>{function e(s){const u=s.target;if(!(u.tagName==="INPUT"||u.tagName==="TEXTAREA"||u.contentEditable==="true"))switch(s.code){case"Space":s.preventDefault(),F();break;case"ArrowLeft":s.preventDefault(),U();break;case"ArrowRight":s.preventDefault(),z();break;case"KeyM":s.preventDefault(),K();break;case"ArrowUp":s.preventDefault(),B([Math.min(y.value+.1,1)]);break;case"ArrowDown":s.preventDefault(),B([Math.max(y.value-.1,0)]);break}}document.addEventListener("keydown",e),q(()=>{document.removeEventListener("keydown",e)})}),(e,s)=>(i(),h(W,null,[o(t(Te),{title:`${e.audio.name} - Audio Course`},null,8,["title"]),o(Me,{breadcrumbs:oe},{default:r(()=>[a("div",We,[o(t(b),{asChild:"",variant:"ghost",class:"mb-4"},{default:r(()=>[o(t(Pe),{href:"/audio"},{default:r(()=>[o(t(Ve),{class:"h-4 w-4 mr-2"}),s[1]||(s[1]=v(" Back to Audio Courses "))]),_:1})]),_:1}),o(t(Q),null,{default:r(()=>[o(t(Y),{class:"p-6"},{default:r(()=>[a("div",Je,[a("div",Qe,[e.audio.thumbnail_url&&!N.value?(i(),h("img",{key:0,src:e.audio.thumbnail_url,alt:e.audio.name,class:"w-full h-full object-cover",onError:ce},null,40,Ye)):(i(),h("div",Ze,[o(t(V),{class:"h-16 w-16 text-blue-500"})])),f.value||w.value?(i(),h("div",ea,[a("div",aa,[o(t(S),{class:"h-8 w-8 text-blue-600 animate-spin"})])])):k("",!0)]),a("div",sa,[a("div",null,[e.audio.category?(i(),h("div",ta,[o(t(Ne),{class:"h-4 w-4 text-muted-foreground"}),o(t(De),{variant:"outline"},{default:r(()=>[v(d(e.audio.category.name),1)]),_:1})])):k("",!0),o(t(Z),{class:"text-2xl mb-2"},{default:r(()=>[v(d(e.audio.name),1)]),_:1}),o(t($e),{class:"text-base"},{default:r(()=>[v(d(e.audio.description||"No description available"),1)]),_:1})]),a("div",oa,[a("div",la,[o(t(je),{class:"h-4 w-4"}),a("span",null,d(e.audio.formatted_duration),1)]),a("div",ra,[o(t(Ie),{class:"h-4 w-4"}),a("span",null,d(Math.round(e.user_progress.completion_percentage))+"% Complete",1)]),a("div",ua,[o(t(qe),{class:"h-4 w-4"}),a("span",null,d(E.value),1)]),e.user_progress.is_completed?(i(),h("div",na,[o(t(ae),{class:"h-4 w-4"}),s[2]||(s[2]=a("span",null,"Completed",-1))])):k("",!0)]),a("div",ia,[a("div",da,[s[3]||(s[3]=a("span",{class:"text-muted-foreground"},"Overall Progress",-1)),a("span",ca,d(Math.round(e.user_progress.completion_percentage))+"%",1)]),o(t(Ee),{value:e.user_progress.completion_percentage,class:"h-2"},null,8,["value"]),a("div",ma,[a("span",null,d(e.user_progress.formatted_current_time)+" / "+d(e.audio.formatted_duration),1),a("span",null,d(E.value),1)])])])])]),_:1})]),_:1}),o(t(Q),null,{default:r(()=>[o(t(Le),null,{default:r(()=>[o(t(Z),{class:"flex items-center gap-2"},{default:r(()=>[o(t(V),{class:"h-5 w-5"}),s[5]||(s[5]=v(" Audio Player ")),f.value?(i(),h("div",fa,[o(t(S),{class:"h-4 w-4 animate-spin"}),s[4]||(s[4]=v(" Buffering... "))])):k("",!0)]),_:1})]),_:1}),o(t(Y),{class:"space-y-6"},{default:r(()=>[a("audio",{ref_key:"audioRef",ref:l,src:e.audio.google_cloud_url,preload:"metadata",onLoadstart:ve,onCanplay:pe,onLoadeddata:ge,onTimeupdate:_e,onPlay:he,onPause:ye,onEnded:be,onWaiting:ke,onPlaying:xe,onError:we,crossorigin:"anonymous"},null,40,va),p.value?(i(),T(t(Re),{key:0,variant:"destructive"},{default:r(()=>[o(t(Fe),{class:"h-4 w-4"}),o(t(Be),null,{default:r(()=>[a("div",pa,[a("p",null,d(p.value),1),a("div",ga,[o(t(b),{onClick:fe,size:"sm",variant:"outline"},{default:r(()=>[o(t(S),{class:"h-4 w-4 mr-2"}),s[6]||(s[6]=v(" Retry "))]),_:1}),o(t(b),{asChild:"",size:"sm",variant:"outline"},{default:r(()=>[a("a",{href:e.audio.google_cloud_url,target:"_blank"},[o(t(ze),{class:"h-4 w-4 mr-2"}),s[7]||(s[7]=v(" Open Direct Link "))],8,_a)]),_:1})])])]),_:1})]),_:1})):k("",!0),w.value&&!p.value?(i(),h("div",ha,[a("div",ya,[o(t(S),{class:"h-5 w-5 animate-spin"}),s[8]||(s[8]=a("span",null,"Loading audio from Google Drive...",-1))]),s[9]||(s[9]=a("div",{class:"text-sm text-muted-foreground"}," This may take a moment for large files ",-1))])):k("",!0),!w.value&&!p.value?(i(),h("div",ba,[a("div",ka,[o(t(b),{onClick:U,variant:"outline",size:"sm",disabled:!_.value},{default:r(()=>[o(t(Ue),{class:"h-4 w-4"})]),_:1},8,["disabled"]),o(t(b),{onClick:F,size:"lg",class:"h-14 w-14 rounded-full relative",disabled:!_.value},{default:r(()=>[f.value?(i(),T(t(S),{key:0,class:"h-6 w-6 animate-spin"})):x.value?(i(),T(t(He),{key:2,class:"h-6 w-6"})):(i(),T(t(Oe),{key:1,class:"h-6 w-6 ml-0.5"}))]),_:1},8,["disabled"]),o(t(b),{onClick:z,variant:"outline",size:"sm",disabled:!_.value},{default:r(()=>[o(t(Xe),{class:"h-4 w-4"})]),_:1},8,["disabled"])]),a("div",xa,[a("div",wa,[a("span",null,d(ue.value),1),a("span",null,d(ne.value),1)]),o(t(ee),{value:[n.value],max:g.value,step:1,"onUpdate:modelValue":s[0]||(s[0]=u=>R(u[0])),class:"w-full",disabled:!_.value},null,8,["value","max","disabled"]),a("div",Ca,[a("span",null,d(Math.round(de.value))+"% played",1),a("span",null,d(E.value),1)])]),a("div",Ta,[a("div",Pa,[o(t(b),{onClick:K,variant:"ghost",size:"sm"},{default:r(()=>[!P.value&&y.value>0?(i(),T(t(V),{key:0,class:"h-4 w-4"})):(i(),T(t(Ke),{key:1,class:"h-4 w-4"}))]),_:1}),o(t(ee),{value:[y.value],max:1,step:.1,"onUpdate:modelValue":B,class:"w-24"},null,8,["value"]),a("span",Aa,d(Math.round(y.value*100))+"% ",1)]),a("div",Ma,[s[10]||(s[10]=a("span",{class:"text-sm text-muted-foreground"},"Speed:",-1)),a("div",Sa,[(i(),h(W,null,Ae(re,u=>o(t(b),{key:u,onClick:X=>me(u),variant:$.value===u?"default":"outline",size:"sm",class:"text-xs px-2 py-1 h-auto"},{default:r(()=>[v(d(u)+"x ",1)]),_:2},1032,["onClick","variant"])),64))])]),ie.value&&!e.user_progress.is_completed?(i(),T(t(b),{key:0,onClick:O,variant:"outline",size:"sm",class:"gap-2"},{default:r(()=>[o(t(ae),{class:"h-4 w-4"}),s[11]||(s[11]=v(" Mark Complete "))]),_:1})):k("",!0)]),s[12]||(s[12]=a("div",{class:"text-xs text-muted-foreground text-center space-y-1"},[a("div",{class:"font-medium"},"Keyboard Shortcuts:"),a("div",{class:"flex flex-wrap justify-center gap-x-4 gap-y-1"},[a("span",null,[a("kbd",{class:"px-1 bg-muted rounded"},"Space"),v(" Play/Pause")]),a("span",null,[a("kbd",{class:"px-1 bg-muted rounded"},"←/→"),v(" Skip 15s")]),a("span",null,[a("kbd",{class:"px-1 bg-muted rounded"},"M"),v(" Mute")]),a("span",null,[a("kbd",{class:"px-1 bg-muted rounded"},"↑/↓"),v(" Volume")])])],-1))])):k("",!0)]),_:1})]),_:1})])]),_:1})],64))}}),vs=Ge($a,[["__scopeId","data-v-1adc3146"]]);export{vs as default};
