import{r as k,c as b,W as N,d as M,l as P,o as n,w as y,e as t,a,u as d,F as h,h as v,t as l,j as f,n as w,b as C,P as D}from"./app-UYTjIL7K.js";import{_ as B}from"./AttendanceLayout-BstTE2Ft.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-CuKQ7c1n.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DXk8l_l7.js";import"./index-DN_WECjT.js";function A(i=[]){const m=k(!1),x=k(!1),u=k(!1),r=k({rating:3,comment:""}),c=b(()=>i.some(o=>o.clock_out===null)),e=b(()=>i.find(o=>o.clock_out===null)||{}),s=b(()=>[...i].sort((o,_)=>new Date(_.clock_in)-new Date(o.clock_in)).slice(0,5));function p(o){return o?new Date(o).toLocaleString():"—"}function g(o){return o?new Date(o).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}):"—"}function O(o){if(!o)return"—";const _=Math.floor(o/60),$=o%60;return _>0?`${_}h ${$}m`:`${$}m`}async function S(){try{m.value=!0,N.post("/clock-in",{},{onSuccess:()=>{console.log("Clock in successful")},onError:o=>{console.error("Clock in failed:",o),alert("Failed to clock in. Please try again.")},onFinish:()=>{m.value=!1}})}catch(o){console.error("Clock in exception:",o),m.value=!1}}function F(){u.value=!0,r.value={rating:3,comment:""}}async function L(){if(!r.value.rating){alert("Please provide a rating");return}try{x.value=!0,N.post("/clock-out",{rating:r.value.rating,comment:r.value.comment},{onSuccess:()=>{console.log("Clock out successful"),u.value=!1},onError:o=>{console.error("Clock out failed:",o),alert("Failed to clock out. Please try again.")},onFinish:()=>{x.value=!1}})}catch(o){console.error("Clock out exception:",o),x.value=!1}}return{isLoading:m,isSubmitting:x,showClockOutModal:u,clockOutForm:r,activeSession:c,activeSessionData:e,recentClockings:s,formatDate:p,formatDateShort:g,formatDuration:O,clockIn:S,openClockOutDialog:F,submitClockOut:L}}const I={class:"bg-white rounded-lg shadow overflow-hidden"},j={class:"md:hidden space-y-4 p-4"},z={key:0,class:"animate-pulse space-y-4"},E={key:1,class:"text-center py-8"},R={class:"grid grid-cols-2 gap-3"},V={class:"col-span-2 mb-2"},G={class:"text-sm font-medium text-gray-900"},T={class:"text-sm font-medium text-gray-900"},W={class:"text-sm font-medium text-gray-900"},q={class:"text-sm font-medium text-gray-900"},H={key:0},U={key:1},J={class:"flex items-center text-sm font-medium text-gray-900"},K={key:0,class:"flex items-center"},Q={class:"mr-1"},X={class:"flex text-yellow-400"},Y={key:1},Z={class:"mt-3"},tt={class:"text-sm font-medium text-gray-900"},et={class:"hidden md:block"},st={class:"min-w-full divide-y divide-gray-200"},ot={class:"bg-white divide-y divide-gray-200"},nt={key:0,class:"animate-pulse"},at={key:1,class:"text-center"},lt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},it={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},rt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ct={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},dt={key:0},ut={key:1},xt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},gt={key:0,class:"flex items-center"},mt={class:"mr-1"},pt={class:"flex"},yt={key:1},ft={class:"px-6 py-4 text-sm text-gray-900"},_t={class:"px-6 py-4 border-t border-gray-200"},kt={class:"flex justify-center"},ht={class:"flex items-center space-x-2"},vt={class:"text-sm text-gray-700"},Nt=M({__name:"Table",props:{clockings:{type:Object,required:!0,default:()=>({data:[],current_page:1,last_page:1,prev_page_url:null,next_page_url:null})}},setup(i){const m=i,{isLoading:x,formatDate:u}=A(m.clockings.data);function r(c){if(!c||isNaN(c)||c<0)return"0 minutes";c=Math.round(c);const e=Math.floor(c/60),s=c%60;return e>0?`${e} ${e===1?"hour":"hours"}${s>0?` ${s} ${s===1?"minute":"minutes"}`:""}`:`${s} ${s===1?"minute":"minutes"}`}return(c,e)=>(n(),P(B,{title:"My Attendance Records"},{actions:y(()=>[C(d(D),{href:"/attendance/clock",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition"},{default:y(()=>e[0]||(e[0]=[f(" Clock In/Out ")])),_:1})]),default:y(()=>[t("div",I,[t("div",j,[d(x)?(n(),a("div",z,e[1]||(e[1]=[t("div",{class:"h-24 bg-gray-200 rounded"},null,-1),t("div",{class:"h-24 bg-gray-200 rounded"},null,-1)]))):i.clockings.data.length===0?(n(),a("div",E,e[2]||(e[2]=[t("p",{class:"text-sm text-gray-500"},"No attendance records found",-1)]))):(n(!0),a(h,{key:2},v(i.clockings.data,(s,p)=>(n(),a("div",{key:p,class:"border border-gray-200 rounded-lg p-4 bg-white shadow-sm"},[t("div",R,[t("div",V,[e[3]||(e[3]=t("div",{class:"text-xs text-gray-500"},"Course",-1)),t("div",G,l(s.course_name||"General Attendance"),1)]),t("div",null,[e[4]||(e[4]=t("div",{class:"text-xs text-gray-500"},"Clock In",-1)),t("div",T,l(d(u)(s.clock_in)),1)]),t("div",null,[e[5]||(e[5]=t("div",{class:"text-xs text-gray-500"},"Clock Out",-1)),t("div",W,l(s.clock_out?d(u)(s.clock_out):"—"),1)]),t("div",null,[e[7]||(e[7]=t("div",{class:"text-xs text-gray-500"},"Duration",-1)),t("div",q,[s.clock_out?(n(),a("span",H,l(r(s.duration_in_minutes)),1)):(n(),a("span",U,[f(l(r(s.current_duration||0))+" ",1),e[6]||(e[6]=t("span",{class:"text-xs text-blue-500"},"(ongoing)",-1))]))])]),t("div",null,[e[9]||(e[9]=t("div",{class:"text-xs text-gray-500"},"Rating",-1)),t("div",J,[s.rating?(n(),a("div",K,[t("span",Q,l(s.rating),1),t("div",X,[(n(),a(h,null,v(5,g=>t("svg",{key:g,class:w([[g<=s.rating?"text-yellow-400":"text-gray-300"],"h-4 w-4"]),fill:"currentColor",viewBox:"0 0 20 20"},e[8]||(e[8]=[t("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"},null,-1)]),2)),64))])])):(n(),a("span",Y,"—"))])])]),t("div",Z,[e[10]||(e[10]=t("div",{class:"text-xs text-gray-500"},"Comment",-1)),t("div",tt,l(s.comment||"—"),1)])]))),128))]),t("div",et,[t("table",st,[e[15]||(e[15]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Course"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clock In"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Clock Out"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Duration"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Rating"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Comment")])],-1)),t("tbody",ot,[d(x)?(n(),a("tr",nt,e[11]||(e[11]=[t("td",{colspan:"6",class:"px-6 py-4"},[t("div",{class:"h-4 bg-gray-200 rounded w-3/4"})],-1)]))):i.clockings.data.length===0?(n(),a("tr",at,e[12]||(e[12]=[t("td",{colspan:"6",class:"px-6 py-4 text-sm text-gray-500"},"No attendance records found",-1)]))):(n(!0),a(h,{key:2},v(i.clockings.data,(s,p)=>(n(),a("tr",{key:p,class:"hover:bg-gray-50"},[t("td",lt,l(s.course_name||"General Attendance"),1),t("td",it,l(d(u)(s.clock_in)),1),t("td",rt,l(s.clock_out?d(u)(s.clock_out):"—"),1),t("td",ct,[s.clock_out?(n(),a("span",dt,l(r(s.duration_in_minutes)),1)):(n(),a("span",ut,[f(l(r(s.current_duration||0))+" ",1),e[13]||(e[13]=t("span",{class:"text-xs text-blue-500"},"(ongoing)",-1))]))]),t("td",xt,[s.rating?(n(),a("div",gt,[t("span",mt,l(s.rating),1),t("div",pt,[(n(),a(h,null,v(5,g=>t("svg",{key:g,class:w([[g<=s.rating?"text-yellow-400":"text-gray-300"],"h-4 w-4"]),fill:"currentColor",viewBox:"0 0 20 20"},e[14]||(e[14]=[t("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"},null,-1)]),2)),64))])])):(n(),a("span",yt,"—"))]),t("td",ft,l(s.comment||"—"),1)]))),128))])])]),t("div",_t,[t("div",kt,[t("nav",ht,[C(d(D),{href:i.clockings.prev_page_url,class:w(["px-3 py-1 rounded border border-gray-300 text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition",!i.clockings.prev_page_url&&"opacity-50 cursor-not-allowed pointer-events-none"])},{default:y(()=>e[16]||(e[16]=[f(" Previous ")])),_:1},8,["href","class"]),t("span",vt," Page "+l(i.clockings.current_page)+" of "+l(i.clockings.last_page),1),C(d(D),{href:i.clockings.next_page_url,class:w(["px-3 py-1 rounded border border-gray-300 text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition",!i.clockings.next_page_url&&"opacity-50 cursor-not-allowed pointer-events-none"])},{default:y(()=>e[17]||(e[17]=[f(" Next ")])),_:1},8,["href","class"])])])])])]),_:1}))}});export{Nt as default};
