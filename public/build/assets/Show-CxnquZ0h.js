import{d as Te,r as m,c as x,B as q,p as G,a as h,o as d,b as o,u as s,m as Pe,w as r,e as a,P as Ae,f as p,h as k,t as c,g as w,F as W,i as Se,bU as J}from"./app-DtSnzWo7.js";import{V,f as Me}from"./AppLayout.vue_vue_type_script_setup_true_lang-Do3Ln1hG.js";import{c as $e,_ as b}from"./Button.vue_vue_type_script_setup_true_lang-DCNzp3Fm.js";import{_ as Q}from"./Card.vue_vue_type_script_setup_true_lang-DjTO-PQU.js";import{_ as Y}from"./CardContent.vue_vue_type_script_setup_true_lang-BbAgelJQ.js";import{_ as Le}from"./CardDescription.vue_vue_type_script_setup_true_lang-BW987d1B.js";import{_ as Ee}from"./CardHeader.vue_vue_type_script_setup_true_lang-1itOhzfS.js";import{_ as Z}from"./CardTitle.vue_vue_type_script_setup_true_lang-FSmJ_BHu.js";import{_ as Be}from"./index-CcoSNzvS.js";import{_ as ee}from"./Slider.vue_vue_type_script_setup_true_lang-CEcO1_qX.js";import{_ as De}from"./Progress.vue_vue_type_script_setup_true_lang-BM-1wH-3.js";import{_ as Re,a as Ve}from"./index-DgB6bd_6.js";import{A as Ne}from"./arrow-left-BTojI5iW.js";import{R as M}from"./refresh-cw-Co1WUqQ5.js";import{B as je}from"./book-open-DH2Oj5wo.js";import{C as Fe}from"./clock-CI-ZGvYD.js";import{R as Ie}from"./rotate-ccw-CDuq_O26.js";import{C as ae}from"./circle-check-big-TweBCu_p.js";import{T as Ue}from"./triangle-alert-BkTJYwkK.js";import{E as ze}from"./external-link-7gLTIG-N.js";import{S as He,V as Ke}from"./volume-x-DItkm3yj.js";import{P as Oe}from"./play-LrkAtc_v.js";import{P as Xe}from"./pause-Bfd72pLy.js";import{S as qe}from"./skip-forward-CyOE0iav.js";import{_ as Ge}from"./_plugin-vue_export-helper-BHpjKEm7.js";import"./index-DimHigGO.js";import"./index-DC7rIJ0i.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-C_Lh75D5.js";import"./useForwardPropsEmits-BCPaGzil.js";import"./useSize-B8beHV00.js";import"./useForwardExpose-DVu94Vhq.js";import"./Collection-CZwDbcrl.js";import"./ConfigProvider-DvzpjfG7.js";import"./usePrimitiveElement-8dYty2xl.js";import"./VisuallyHidden-CkOSyD4i.js";import"./VisuallyHiddenInput-CDgmIVul.js";import"./nullish-CHIgUVhi.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=$e("HeadphonesIcon",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]),Je={class:"max-w-4xl mx-auto space-y-6"},Qe={class:"flex flex-col md:flex-row gap-6"},Ye={class:"w-full md:w-64 aspect-video bg-gradient-to-br from-blue-100 to-purple-100 rounded-lg overflow-hidden shrink-0 relative"},Ze=["src","alt"],ea={key:1,class:"w-full h-full flex items-center justify-center"},aa={key:2,class:"absolute inset-0 bg-black/20 flex items-center justify-center"},ta={class:"bg-white/90 rounded-full p-3"},sa={class:"flex-1 space-y-4"},oa={key:0,class:"flex items-center gap-2 mb-2"},la={class:"flex flex-wrap items-center gap-4"},ra={class:"flex items-center gap-2 text-sm text-muted-foreground"},ua={class:"flex items-center gap-2 text-sm text-blue-600"},na={class:"flex items-center gap-2 text-sm text-purple-600"},ia={key:0,class:"flex items-center gap-2 text-sm text-green-600"},da={class:"space-y-2"},ca={class:"flex justify-between items-center text-sm"},ma={class:"font-medium"},fa={class:"flex justify-between text-xs text-muted-foreground"},va={key:0,class:"ml-2 flex items-center gap-2 text-sm text-muted-foreground"},pa=["src"],ga={class:"space-y-3"},_a={class:"flex gap-2"},ha=["href"],ya={key:1,class:"text-center py-8"},ka={class:"flex items-center justify-center gap-2 text-muted-foreground mb-4"},ba={key:2,class:"space-y-6"},xa={class:"flex items-center justify-center gap-4"},wa={class:"space-y-2"},Ca={class:"flex justify-between text-sm text-muted-foreground"},Ta={class:"flex justify-between text-xs text-muted-foreground"},Pa={class:"flex flex-col sm:flex-row items-center justify-between gap-4"},Aa={class:"flex items-center gap-3"},Sa={class:"text-xs text-muted-foreground min-w-[3ch]"},Ma={class:"flex items-center gap-2"},$a={class:"flex gap-1"},La=Te({__name:"Show",props:{audio:{},user_progress:{}},setup(te){var O;const u=te,se=(O=document.querySelector('meta[name="csrf-token"]'))==null?void 0:O.getAttribute("content"),oe=[{name:"Home",href:"/dashboard"},{name:"Audio Courses",href:"/audio"},{name:u.audio.name,href:`/audio/${u.audio.id}`}],l=m(),C=m(!1),i=m(u.user_progress.current_time||0),g=m(u.audio.duration||0),y=m(1),P=m(!1),$=m(1),T=m(!0),f=m(""),v=m(!1),_=m(!1),le=x(()=>Math.floor(i.value)),N=m(!1),re=x(()=>u.audio.storage_type==="local"?`/audio/${u.audio.id}/stream`:u.audio.google_cloud_url),L=m(i.value),E=m(),A=m(),ue=[.5,.75,1,1.25,1.5,1.75,2],j=x(()=>g.value>0?i.value/g.value*100:0),ne=x(()=>F(i.value)),ie=x(()=>F(g.value)),de=x(()=>j.value>=95||i.value>=g.value-30),ce=x(()=>Math.min(j.value,100)),B=x(()=>{const e=le.value,t=Math.floor(e/60),n=e%60;return t>0?n>0?`${t}m ${n}s listened`:`${t}m listened`:n>0?`${n}s listened`:"0m listened"});function F(e){if(!e||isNaN(e))return"00:00";const t=Math.floor(e/60),n=Math.floor(e%60);return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}function me(){N.value=!0}function I(){!l.value||!_.value||(C.value?l.value.pause():(v.value=!0,l.value.play().catch(e=>{console.error("Play failed:",e),f.value="Unable to play audio. The file might be restricted or your connection is slow.",v.value=!1})))}function D(e){!l.value||!_.value||(v.value=!0,l.value.currentTime=e,i.value=e,A.value&&clearTimeout(A.value),A.value=setTimeout(()=>{S()},1e3))}function U(){const e=Math.min(i.value+15,g.value);D(e)}function z(){const e=Math.max(i.value-15,0);D(e)}function H(){l.value&&(P.value=!P.value,l.value.muted=P.value)}function R(e){l.value&&(y.value=e[0],l.value.volume=y.value,y.value>0&&P.value&&(P.value=!1,l.value.muted=!1))}function fe(e){l.value&&($.value=e,l.value.playbackRate=e)}async function S(){console.log("saveProgress called!",{currentTime:i.value,lastSavedTime:L.value,audioId:u.audio.id});try{const e=Math.abs(i.value-L.value);if(e>=1){const t=await J.post(`/audio/${u.audio.id}/progress`,{current_time:i.value,total_listened_time:u.user_progress.total_listened_time+e});console.log("Progress API response:",t.data),t.data.success&&t.data.progress&&(u.user_progress.current_time=t.data.progress.current_time,u.user_progress.completion_percentage=t.data.progress.completion_percentage,u.user_progress.is_completed=t.data.progress.is_completed,console.log("✅ Local progress updated:",{completion:u.user_progress.completion_percentage,is_completed:u.user_progress.is_completed}),L.value=i.value)}}catch(e){console.error("Failed to save progress:",e.response||e)}}async function K(){console.log("markCompleted called for audio ID:",u.audio.id);try{const e=await J.post(`/audio/${u.audio.id}/complete`,{},{headers:{"X-CSRF-TOKEN":se}});console.log("Complete API response:",e.data),e.data.success&&(console.log("Audio marked as completed successfully"),setTimeout(()=>{window.location.reload()},1e3))}catch(e){console.error("Failed to mark as completed:",e.response||e),e.value="Failed to mark as completed. Please try again."}}function ve(){l.value&&(f.value="",T.value=!0,_.value=!1,l.value.load())}function pe(){T.value=!0,v.value=!0,console.log("Audio loading started")}function ge(){_.value=!0,v.value=!1,console.log("Audio can start playing")}function _e(){l.value&&(g.value=l.value.duration||u.audio.duration,i.value>0&&i.value<g.value&&(l.value.currentTime=i.value),T.value=!1,v.value=!1,_.value=!0,f.value="",console.log("Audio loaded successfully, duration:",g.value,"resume from:",i.value))}function he(){l.value&&(i.value=l.value.currentTime,v.value=!1)}function ye(){C.value=!0,v.value=!1}function ke(){C.value=!1,S()}function be(){C.value=!1,i.value=g.value,u.user_progress.is_completed||K()}function xe(){v.value=!0,console.log("Audio is buffering...")}function we(){v.value=!1,C.value=!0}function Ce(e){var t;if(console.error("Audio loading error:",e),(t=l.value)!=null&&t.error){const n=l.value.error.code,X=l.value.error.message;switch(console.error("Audio error details:",{code:n,message:X}),n){case 1:f.value="Audio loading was aborted. Please try again.";break;case 2:f.value="Network error while loading audio. Check your connection and try again.";break;case 3:f.value="Audio file is corrupted or in an unsupported format.";break;case 4:f.value="Audio file format is not supported or file is not accessible.";break;default:f.value="Failed to load audio. The file might be private or moved."}}else u.audio.storage_type==="local"?f.value="Failed to load audio from local storage. Please contact support.":f.value="Failed to load audio from Google Drive. Please check if the file is publicly accessible.";T.value=!1,v.value=!1,_.value=!1}return q(()=>{l.value&&(l.value.volume=y.value,l.value.playbackRate=$.value,l.value.preload="metadata"),E.value=setInterval(()=>{C.value&&S()},1e4);const e=()=>{S()};window.addEventListener("beforeunload",e),G(()=>{E.value&&clearInterval(E.value),A.value&&clearTimeout(A.value),window.removeEventListener("beforeunload",e),S()})}),q(()=>{function e(t){const n=t.target;if(!(n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.contentEditable==="true"))switch(t.code){case"Space":t.preventDefault(),I();break;case"ArrowLeft":t.preventDefault(),z();break;case"ArrowRight":t.preventDefault(),U();break;case"KeyM":t.preventDefault(),H();break;case"ArrowUp":t.preventDefault(),R([Math.min(y.value+.1,1)]);break;case"ArrowDown":t.preventDefault(),R([Math.max(y.value-.1,0)]);break}}document.addEventListener("keydown",e),G(()=>{document.removeEventListener("keydown",e)})}),(e,t)=>(d(),h(W,null,[o(s(Pe),{title:`${e.audio.name} - Audio Course`},null,8,["title"]),o(Me,{breadcrumbs:oe},{default:r(()=>[a("div",Je,[o(s(b),{asChild:"",variant:"ghost",class:"mb-4"},{default:r(()=>[o(s(Ae),{href:"/audio"},{default:r(()=>[o(s(Ne),{class:"h-4 w-4 mr-2"}),t[1]||(t[1]=p(" Back to Audio Courses "))]),_:1})]),_:1}),o(s(Q),null,{default:r(()=>[o(s(Y),{class:"p-6"},{default:r(()=>[a("div",Qe,[a("div",Ye,[e.audio.thumbnail_url&&!N.value?(d(),h("img",{key:0,src:e.audio.thumbnail_url,alt:e.audio.name,class:"w-full h-full object-cover",onError:me},null,40,Ze)):(d(),h("div",ea,[o(s(V),{class:"h-16 w-16 text-blue-500"})])),v.value||T.value?(d(),h("div",aa,[a("div",ta,[o(s(M),{class:"h-8 w-8 text-blue-600 animate-spin"})])])):k("",!0)]),a("div",sa,[a("div",null,[e.audio.category?(d(),h("div",oa,[o(s(je),{class:"h-4 w-4 text-muted-foreground"}),o(s(Be),{variant:"outline"},{default:r(()=>[p(c(e.audio.category.name),1)]),_:1})])):k("",!0),o(s(Z),{class:"text-2xl mb-2"},{default:r(()=>[p(c(e.audio.name),1)]),_:1}),o(s(Le),{class:"text-base"},{default:r(()=>[p(c(e.audio.description||"No description available"),1)]),_:1})]),a("div",la,[a("div",ra,[o(s(Fe),{class:"h-4 w-4"}),a("span",null,c(e.audio.formatted_duration),1)]),a("div",ua,[o(s(Ie),{class:"h-4 w-4"}),a("span",null,c(Math.round(e.user_progress.completion_percentage))+"% Complete",1)]),a("div",na,[o(s(We),{class:"h-4 w-4"}),a("span",null,c(B.value),1)]),e.user_progress.is_completed?(d(),h("div",ia,[o(s(ae),{class:"h-4 w-4"}),t[2]||(t[2]=a("span",null,"Completed",-1))])):k("",!0)]),a("div",da,[a("div",ca,[t[3]||(t[3]=a("span",{class:"text-muted-foreground"},"Overall Progress",-1)),a("span",ma,c(Math.round(e.user_progress.completion_percentage))+"%",1)]),o(s(De),{value:e.user_progress.completion_percentage,class:"h-2"},null,8,["value"]),a("div",fa,[a("span",null,c(e.user_progress.formatted_current_time)+" / "+c(e.audio.formatted_duration),1),a("span",null,c(B.value),1)])])])])]),_:1})]),_:1}),o(s(Q),null,{default:r(()=>[o(s(Ee),null,{default:r(()=>[o(s(Z),{class:"flex items-center gap-2"},{default:r(()=>[o(s(V),{class:"h-5 w-5"}),t[5]||(t[5]=p(" Audio Player ")),v.value?(d(),h("div",va,[o(s(M),{class:"h-4 w-4 animate-spin"}),t[4]||(t[4]=p(" Buffering... "))])):k("",!0)]),_:1})]),_:1}),o(s(Y),{class:"space-y-6"},{default:r(()=>[a("audio",{ref_key:"audioRef",ref:l,src:re.value,preload:"metadata",onLoadstart:pe,onCanplay:ge,onLoadeddata:_e,onTimeupdate:he,onPlay:ye,onPause:ke,onEnded:be,onWaiting:xe,onPlaying:we,onError:Ce,crossorigin:"anonymous"},null,40,pa),f.value?(d(),w(s(Re),{key:0,variant:"destructive"},{default:r(()=>[o(s(Ue),{class:"h-4 w-4"}),o(s(Ve),null,{default:r(()=>[a("div",ga,[a("p",null,c(f.value),1),a("div",_a,[o(s(b),{onClick:ve,size:"sm",variant:"outline"},{default:r(()=>[o(s(M),{class:"h-4 w-4 mr-2"}),t[6]||(t[6]=p(" Retry "))]),_:1}),e.audio.storage_type==="google_drive"?(d(),w(s(b),{key:0,asChild:"",size:"sm",variant:"outline"},{default:r(()=>[a("a",{href:e.audio.google_cloud_url,target:"_blank"},[o(s(ze),{class:"h-4 w-4 mr-2"}),t[7]||(t[7]=p(" Open Direct Link "))],8,ha)]),_:1})):k("",!0)])])]),_:1})]),_:1})):k("",!0),T.value&&!f.value?(d(),h("div",ya,[a("div",ka,[o(s(M),{class:"h-5 w-5 animate-spin"}),t[8]||(t[8]=a("span",null,"Loading audio...",-1))]),t[9]||(t[9]=a("div",{class:"text-sm text-muted-foreground"}," This may take a moment for large files ",-1))])):k("",!0),!T.value&&!f.value?(d(),h("div",ba,[a("div",xa,[o(s(b),{onClick:z,variant:"outline",size:"sm",disabled:!_.value},{default:r(()=>[o(s(He),{class:"h-4 w-4"})]),_:1},8,["disabled"]),o(s(b),{onClick:I,size:"lg",class:"h-14 w-14 rounded-full relative",disabled:!_.value},{default:r(()=>[v.value?(d(),w(s(M),{key:0,class:"h-6 w-6 animate-spin"})):C.value?(d(),w(s(Xe),{key:2,class:"h-6 w-6"})):(d(),w(s(Oe),{key:1,class:"h-6 w-6 ml-0.5"}))]),_:1},8,["disabled"]),o(s(b),{onClick:U,variant:"outline",size:"sm",disabled:!_.value},{default:r(()=>[o(s(qe),{class:"h-4 w-4"})]),_:1},8,["disabled"])]),a("div",wa,[a("div",Ca,[a("span",null,c(ne.value),1),a("span",null,c(ie.value),1)]),o(s(ee),{value:[i.value],max:g.value,step:1,"onUpdate:modelValue":t[0]||(t[0]=n=>D(n[0])),class:"w-full",disabled:!_.value},null,8,["value","max","disabled"]),a("div",Ta,[a("span",null,c(Math.round(ce.value))+"% played",1),a("span",null,c(B.value),1)])]),a("div",Pa,[a("div",Aa,[o(s(b),{onClick:H,variant:"ghost",size:"sm"},{default:r(()=>[!P.value&&y.value>0?(d(),w(s(V),{key:0,class:"h-4 w-4"})):(d(),w(s(Ke),{key:1,class:"h-4 w-4"}))]),_:1}),o(s(ee),{value:[y.value],max:1,step:.1,"onUpdate:modelValue":R,class:"w-24"},null,8,["value"]),a("span",Sa,c(Math.round(y.value*100))+"% ",1)]),a("div",Ma,[t[10]||(t[10]=a("span",{class:"text-sm text-muted-foreground"},"Speed:",-1)),a("div",$a,[(d(),h(W,null,Se(ue,n=>o(s(b),{key:n,onClick:X=>fe(n),variant:$.value===n?"default":"outline",size:"sm",class:"text-xs px-2 py-1 h-auto"},{default:r(()=>[p(c(n)+"x ",1)]),_:2},1032,["onClick","variant"])),64))])]),de.value&&!e.user_progress.is_completed?(d(),w(s(b),{key:0,onClick:K,variant:"outline",size:"sm",class:"gap-2"},{default:r(()=>[o(s(ae),{class:"h-4 w-4"}),t[11]||(t[11]=p(" Mark Complete "))]),_:1})):k("",!0)]),t[12]||(t[12]=a("div",{class:"text-xs text-muted-foreground text-center space-y-1"},[a("div",{class:"font-medium"},"Keyboard Shortcuts:"),a("div",{class:"flex flex-wrap justify-center gap-x-4 gap-y-1"},[a("span",null,[a("kbd",{class:"px-1 bg-muted rounded"},"Space"),p(" Play/Pause")]),a("span",null,[a("kbd",{class:"px-1 bg-muted rounded"},"←/→"),p(" Skip 15s")]),a("span",null,[a("kbd",{class:"px-1 bg-muted rounded"},"M"),p(" Mute")]),a("span",null,[a("kbd",{class:"px-1 bg-muted rounded"},"↑/↓"),p(" Volume")])])],-1))])):k("",!0)]),_:1})]),_:1})])]),_:1})],64))}}),pt=Ge(La,[["__scopeId","data-v-a4fa8034"]]);export{pt as default};
