import{d as M,C as S,r as V,c as p,k as h,o as r,w as f,e,a as n,f as d,l as y,n as g,t as a,p as B,u as l,P as _,j as x,g as k,F as w,h as C,i as z,q as P,b as U}from"./app-iYB6CK9s.js";import{_ as I}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BmAEUQ0k.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-BOHGZ_58.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-B3PnW6xU.js";import"./index-BHiy4VMt.js";const N={class:"px-4 sm:px-0"},F={class:"text-center"},L={class:"relative w-32 h-32 mx-auto mb-6"},E={class:"w-32 h-32 transform -rotate-90",viewBox:"0 0 36 36"},H=["stroke-dasharray"],q={class:"absolute inset-0 flex items-center justify-center"},D={class:"text-2xl font-bold text-gray-700"},T={class:"mb-6"},R={key:0,class:"flex justify-center"},G={key:1,class:"flex justify-center"},J={key:2,class:"flex justify-center"},K={class:"text-xl font-bold mb-3 text-gray-800"},O={key:0},Q={key:1},W={key:2},X={class:"text-gray-600 mb-4 leading-relaxed"},Y={class:"bg-gray-50 rounded-lg p-4 mb-6"},Z={class:"flex justify-between text-sm text-gray-600 mb-2"},ee={class:"w-full bg-gray-200 rounded-full h-2"},se={class:"flex gap-3 justify-center"},te={key:0,class:"text-xs text-gray-500 mt-4"},oe={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},le={class:"p-6 sm:p-8"},re={class:"mb-8"},ne=["disabled"],ie=["value"],ae={key:0,class:"text-red-600 text-sm mt-2"},de={class:"mb-8"},ue={class:"border border-gray-300 rounded-lg p-4 bg-gray-50"},ce={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 max-h-80 overflow-y-auto"},ge=["value","disabled"],me={class:"min-w-0 flex-1"},ve={class:"text-sm font-medium text-gray-900 block truncate"},be={class:"text-xs text-gray-500 block truncate"},fe={key:0,class:"text-red-600 text-sm mt-2"},xe={class:"flex justify-between items-center mt-3"},pe={class:"text-sm text-gray-600"},he={class:"font-medium"},ye={class:"flex gap-2"},_e=["disabled"],ke=["disabled"],we={class:"flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200"},Ce=["disabled"],je={key:0,class:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24"},Ae={key:1},Me={key:2},Se={key:3},Ve={key:4,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Be=M({__name:"Create",props:{courses:Array,users:Array},setup(c){const j=c,o=S({course_id:new URLSearchParams(window.location.search).get("course_id")||"",user_ids:[],course_availability_id:null}),t=V({isVisible:!1,current:0,total:0,status:"sending",message:""});p(()=>j.courses.find(u=>u.id==o.course_id));const m=p(()=>t.value.total===0?0:Math.round(t.value.current/t.value.total*100));function A(){t.value={isVisible:!0,current:0,total:o.user_ids.length,status:"sending",message:"Preparing to send emails..."};const u=setInterval(()=>{t.value.current<t.value.total&&t.value.status==="sending"&&(t.value.current++,t.value.message=`Sending email ${t.value.current} of ${t.value.total}...`)},3e3);o.post("/admin/assignments",{onSuccess:s=>{clearInterval(u),t.value.status="success",t.value.message="All course assignments sent successfully!",t.value.current=t.value.total,setTimeout(()=>{t.value.isVisible=!1},4e3)},onError:s=>{clearInterval(u),t.value.status="error",t.value.message="Some assignments failed to send. Please check the logs."},onFinish:()=>{clearInterval(u)}})}function v(){t.value.isVisible=!1}return(u,s)=>(r(),h(I,null,{default:f(()=>[e("div",N,[s[20]||(s[20]=e("div",{class:"mb-6"},[e("h1",{class:"text-xl sm:text-3xl font-bold text-gray-800 mb-2"},"Assign Course to Users"),e("p",{class:"text-gray-600"},"Select a course and users to send course assignment notifications with login credentials.")],-1)),t.value.isVisible?(r(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:s[1]||(s[1]=i=>t.value.status!=="sending"?v():null)},[e("div",{class:"bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl",onClick:s[0]||(s[0]=y(()=>{},["stop"]))},[e("div",F,[e("div",L,[(r(),n("svg",E,[s[6]||(s[6]=e("path",{class:"text-gray-200",fill:"none",stroke:"currentColor","stroke-width":"2",d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"},null,-1)),e("path",{class:g({"text-blue-500":t.value.status==="sending","text-green-500":t.value.status==="success","text-red-500":t.value.status==="error"}),fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-dasharray":`${m.value}, 100`,d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",style:{transition:"stroke-dasharray 0.3s ease-in-out"}},null,10,H)])),e("div",q,[e("span",D,a(m.value)+"%",1)])]),e("div",T,[t.value.status==="sending"?(r(),n("div",R,s[7]||(s[7]=[e("div",{class:"relative"},[e("div",{class:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center"},[e("svg",{class:"animate-spin h-6 w-6 text-blue-500",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})])])],-1)]))):t.value.status==="success"?(r(),n("div",G,s[8]||(s[8]=[e("div",{class:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center animate-pulse"},[e("svg",{class:"w-8 h-8 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)]))):t.value.status==="error"?(r(),n("div",J,s[9]||(s[9]=[e("div",{class:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])],-1)]))):d("",!0)]),e("h3",K,[t.value.status==="sending"?(r(),n("span",O,"Sending Course Assignments")):t.value.status==="success"?(r(),n("span",Q,"Assignment Complete!")):t.value.status==="error"?(r(),n("span",W,"Assignment Failed")):d("",!0)]),e("p",X,a(t.value.message),1),e("div",Y,[e("div",Z,[s[10]||(s[10]=e("span",null,"Progress",-1)),e("span",null,a(t.value.current)+" / "+a(t.value.total),1)]),e("div",ee,[e("div",{class:g(["h-2 rounded-full transition-all duration-300 ease-out",{"bg-blue-500":t.value.status==="sending","bg-green-500":t.value.status==="success","bg-red-500":t.value.status==="error"}]),style:B({width:m.value+"%"})},null,6)])]),e("div",se,[t.value.status!=="sending"?(r(),n("button",{key:0,onClick:v,class:"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors duration-200 font-medium"}," Close ")):d("",!0),t.value.status==="success"?(r(),h(l(_),{key:1,href:"/admin/assignments",class:"bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors duration-200 font-medium",onClick:v},{default:f(()=>s[11]||(s[11]=[x(" View Assignments ")])),_:1})):d("",!0)]),t.value.status==="sending"?(r(),n("p",te," Please wait while we send the assignment emails... ")):d("",!0)])])])):d("",!0),e("div",oe,[e("div",le,[e("form",{onSubmit:y(A,["prevent"]),class:"max-w-4xl"},[e("div",re,[s[13]||(s[13]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"Select Course *",-1)),k(e("select",{"onUpdate:modelValue":s[2]||(s[2]=i=>l(o).course_id=i),class:"w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-hidden focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",required:"",disabled:l(o).processing},[s[12]||(s[12]=e("option",{value:""},"Choose a course to assign...",-1)),(r(!0),n(w,null,C(c.courses,i=>(r(),n("option",{key:i.id,value:i.id},a(i.name),9,ie))),128))],8,ne),[[z,l(o).course_id]]),l(o).errors.course_id?(r(),n("div",ae,a(l(o).errors.course_id),1)):d("",!0)]),e("div",de,[s[15]||(s[15]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"Select Users *",-1)),e("div",ue,[e("div",ce,[(r(!0),n(w,null,C(c.users,i=>(r(),n("label",{key:i.id,class:g(["flex items-center space-x-3 p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-colors cursor-pointer",{"border-blue-500 bg-blue-50":l(o).user_ids.includes(i.id)}])},[k(e("input",{type:"checkbox",value:i.id,"onUpdate:modelValue":s[3]||(s[3]=b=>l(o).user_ids=b),disabled:l(o).processing,class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,8,ge),[[P,l(o).user_ids]]),e("div",me,[e("span",ve,a(i.name),1),e("span",be,a(i.email),1)])],2))),128))])]),l(o).errors.user_ids?(r(),n("div",fe,a(l(o).errors.user_ids),1)):d("",!0),e("div",xe,[e("p",pe,[e("span",he,a(l(o).user_ids.length),1),x(" user"+a(l(o).user_ids.length!==1?"s":"")+" selected ",1)]),e("div",ye,[e("button",{type:"button",onClick:s[4]||(s[4]=i=>l(o).user_ids=c.users.map(b=>b.id)),class:"text-xs text-blue-600 hover:text-blue-800 font-medium",disabled:l(o).processing}," Select All ",8,_e),s[14]||(s[14]=e("span",{class:"text-gray-300"},"|",-1)),e("button",{type:"button",onClick:s[5]||(s[5]=i=>l(o).user_ids=[]),class:"text-xs text-gray-600 hover:text-gray-800 font-medium",disabled:l(o).processing}," Clear All ",8,ke)])])]),s[19]||(s[19]=e("div",{class:"mb-8 bg-blue-50 border border-blue-200 rounded-lg p-4"},[e("div",{class:"flex"},[e("div",{class:"shrink-0"},[e("svg",{class:"h-5 w-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})])]),e("div",{class:"ml-3"},[e("h3",{class:"text-sm font-medium text-blue-800"},"Assignment Information"),e("div",{class:"mt-2 text-sm text-blue-700"},[e("ul",{class:"list-disc list-inside space-y-1"},[e("li",null,"Selected users will receive an email with course details and login credentials"),e("li",null,"New passwords will be automatically generated and sent to each user"),e("li",null,"Users can accept or decline the course assignment from their email"),e("li",null,"Email sending may take a few moments due to rate limiting")])])])])],-1)),e("div",we,[e("button",{type:"submit",class:"flex-1 sm:flex-none bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 focus:outline-hidden focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors duration-200 font-medium flex items-center justify-center gap-3",disabled:l(o).processing||l(o).user_ids.length===0},[l(o).processing?(r(),n("svg",je,s[16]||(s[16]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):d("",!0),l(o).processing?(r(),n("span",Ae,"Sending Assignments...")):l(o).user_ids.length===0?(r(),n("span",Me,"Select Users to Continue")):(r(),n("span",Se," Assign Course to "+a(l(o).user_ids.length)+" User"+a(l(o).user_ids.length!==1?"s":""),1)),!l(o).processing&&l(o).user_ids.length>0?(r(),n("svg",Ve,s[17]||(s[17]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)]))):d("",!0)],8,Ce),U(l(_),{href:"/admin/assignments",class:g(["flex-1 sm:flex-none bg-gray-100 text-gray-700 px-8 py-3 rounded-lg hover:bg-gray-200 focus:outline-hidden focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors duration-200 font-medium text-center flex items-center justify-center gap-2",{"pointer-events-none opacity-50":l(o).processing}])},{default:f(()=>s[18]||(s[18]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),x(" Back to Assignments ")])),_:1},8,["class"])])],32)])])])]),_:1}))}}),Fe=$(Be,[["__scopeId","data-v-f37dbc2e"]]);export{Fe as default};
